/*! leaflet.travelnotespublictransport - version 1.3.0 - 2018-11-01 - Copyright 2018 Christian Guyette - Contact: http//www.ouaie.be/ - This  program is free software; you can redistribute it and/or modify it under the terms of the GNU General Public License as published by the Free Software Foundation; either version 3 of the License, or any later version.*/


!function d(i,r,o){function u(n,e){if(!r[n]){if(!i[n]){var t="function"==typeof require&&require;if(!e&&t)return t(n,!0);if(c)return c(n,!0);var s=new Error("Cannot find module '"+n+"'");throw s.code="MODULE_NOT_FOUND",s}var a=r[n]={exports:{}};i[n][0].call(a.exports,function(e){return u(i[n][1][e]||e)},a,a.exports,d,i,r,o)}return r[n].exports}for(var c="function"==typeof require&&require,e=0;e<o.length;e++)u(o[e]);return u}({1:[function(e,n,t){!function(){"use strict";var l,d,g,f,I,c,y,i,p,v,r,o,A,u,h,s,W,m,b,w;L.travelNotes.interface().addProvider((d=-1,g=new Map,f=new Map,I=new Map,c=-1,y=0,i=[],p=function(e){return e[0]},v=function(e){return e[e.length-1]},r=function(e,n){e.splice(e.indexOf(n),1)},o=function(e){var n=f.get(p(e.nodesIds)),t=f.get(v(e.nodesIds));r(n.startingWaysIds,e.id),n.endingWaysIds.push(e.id),r(t.endingWaysIds,e.id),t.startingWaysIds.push(e.id),e.nodesIds.reverse()},A=function(e,n){var t=g.get(e),s=g.get(n);v(t.nodesIds)===v(s.nodesIds)?o(s):p(t.nodesIds)===p(s.nodesIds)?o(t):p(t.nodesIds)===v(s.nodesIds)&&(o(t),o(s));var a=f.get(t.nodesIds.pop());a.startingWaysIds=[],a.endingWaysIds=[],t.nodesIds=t.nodesIds.concat(s.nodesIds),t.distance+=s.distance;var d=f.get(v(t.nodesIds));return r(d.endingWaysIds,s.id),d.endingWaysIds.push(t.id),g.delete(s.id),t.id},u=function(e){var n=g.get(e),a={id:c--,type:"way",nodesIds:[],distance:n.distance};return n.nodesIds.forEach(function(e){var n,t,s;a.nodesIds.push((n=e,t=f.get(n),s={id:c--,lat:t.lat,lon:t.lon,type:"node",startingWaysIds:[],endingWaysIds:[],isNode3Ways:t.isNode3Ways},f.set(s.id,s),s.id))}),f.get(p(a.nodesIds)).startingWaysIds.push(a.id),f.get(v(a.nodesIds)).endingWaysIds.push(a.id),g.set(a.id,a),a.id},h=function(){var t=[],s=function(e,n){e.isNode3Ways||n.isNode3Ways||t.push({distance:L.latLng(e.lat,e.lon).distanceTo(L.latLng(n.lat,n.lon)),nodesId:[e.id,n.id]})},a=Array.from(g.values()),d=1;a.forEach(function(e){for(var n=d;n<a.length;n++){var t=[];t.push(f.get(p(e.nodesIds))),t.push(f.get(v(e.nodesIds))),t.push(f.get(p(a[n].nodesIds))),t.push(f.get(v(a[n].nodesIds))),s(t[0],t[2]),s(t[0],t[3]),s(t[1],t[2]),s(t[1],t[3])}d++});var n=t[0];t.forEach(function(e){e.distance<n.distance&&(n=e)});var e={id:c--,type:"way",nodesIds:n.nodesId,distance:n.distance};g.set(e.id,e);var i=f.get(n.nodesId[0]),r=i.startingWaysIds.concat(i.endingWaysIds)[0];i.startingWaysIds.push(e.id);var o=f.get(n.nodesId[1]),u=o.startingWaysIds.concat(o.endingWaysIds)[0];o.endingWaysIds.push(e.id),A(A(e.id,r),u),g.size>2*y+1&&h()},s=function(e,n,t){var s;c=-1,i=[],y=0,s=e.elements,g.clear(),f.clear(),I.clear(),s.forEach(function(e){switch(e.type){case"way":e.nodesIds=e.nodes,delete e.nodes,2<=e.nodesIds.length&&(e.distance=0,g.set(e.id,e));break;case"node":e.startingWaysIds=[],e.endingWaysIds=[],e.isNode3Ways=!1,f.set(e.id,e);break;case"relation":e.members.forEach(function(e){"node"===e.type&&e.role&&"stop"===e.role&&I.set(e.ref,e.ref)})}}),I.forEach(function(e){var n=f.get(e);n?I.set(e,n):(console.log("the relation "+d+" have nodes not positionned on the railway ( node "+e+")."),I.delete(e))}),g.forEach(function(t){f.get(p(t.nodesIds)).startingWaysIds.push(t.id),f.get(v(t.nodesIds)).endingWaysIds.push(t.id);var s=null;t.nodesIds.forEach(function(e){var n=f.get(e);s&&(t.distance+=L.latLng(n.lat,n.lon).distanceTo(L.latLng(s.lat,s.lon))),s=n})});var a=!1;return f.forEach(function(e){var n=e.startingWaysIds.concat(e.endingWaysIds);switch(n.length){case 0:case 1:break;case 2:A(n[0],n[1]);break;case 3:e.isNode3Ways=!0,i.push(e),y++;break;default:a=!0,console.log("A node with more than 3 ways is found : "+e.id+" - the relation "+d+" - ways "+e.startingWaysIds.concat(e.endingWaysIds))}}),!a&&(g.size>2*y+1&&(h(),console.log("Holes found in the OSM relation number "+d+". Try to correct OSM data.")),0<y&&i.forEach(function(e){var t=999999999,s=null,n=e.startingWaysIds.concat(e.endingWaysIds);n.forEach(function(e){var n=g.get(e);n.distance<t&&(t=n.distance,s=n)}),r(n,s.id);var a=g.get(u(s.id)),d=null;d=p(s.nodesIds)===e.id?(a.nodesIds.pop(),a.nodesIds.push(v(s.nodesIds)),p(a.nodesIds)):(a.nodesIds.shift(),a.nodesIds.unshift(p(s.nodesIds)),v(a.nodesIds));var i=g.get(n[1]);i.nodesIds[i.nodesIds.indexOf(e.id)]=d,A(A(A(s.id,a.id),n[0]),i.id)}),function(d){var i=null,r=null,t=999999999,s=999999999;I.forEach(function(e){var n=L.latLng([e.lat,e.lon]).distanceTo(l.first.latLng);n<t&&(t=n,i=e),(n=L.latLng([e.lat,e.lon]).distanceTo(l.last.latLng))<s&&(s=n,r=e)}),d.itinerary.itineraryPoints.removeAll(),d.itinerary.maneuvers.removeAll();var o=0,u=!1;Array.from(g.values())[0].nodesIds.forEach(function(e){if(0!==o||e!==i.id&&e!==r.id?2!==o||e!==i.id&&e!==r.id||(o=3):(o=1,u=e===r.id),0<o&&o<4){var n=L.travelNotes.interface().itineraryPoint,t=f.get(e);n.latLng=[t.lat,t.lon],d.itinerary.itineraryPoints.add(n);var s=I.get(e);if(s){var a=L.travelNotes.interface().maneuver;s.tags&&s.tags.name&&(a.instruction=s.tags.name+"&nbsp;:&nbsp;"),s.id===i.id?(a.iconName="kTrainStart",a.instruction+="Monter sur le train"):s.id===r.id?(a.iconName="kTrainEnd",a.instruction+="Descendre du train"):(a.iconName="kTrainContinue",a.instruction+="Rester sur le train"),a.distance=0,a.duration=0,a.itineraryPointObjId=n.objId,d.itinerary.maneuvers.add(a)}}1===o&&(o=2),3===o&&(o=4)}),u&&(d.itinerary.itineraryPoints.reverse(),d.itinerary.maneuvers.reverse()),d.distance=0;var e=d.itinerary.maneuvers.iterator,n=(e.done,e.value);e.done;var a=d.itinerary.itineraryPoints.iterator;a.done;for(var c=a.value;!a.done;)a.value.distance=0,c.distance=L.latLng(c.latLng).distanceTo(L.latLng(a.value.latLng)),d.distance+=c.distance,n.distance+=c.distance,e.value.itineraryPointObjId===a.value.objId&&((n=e.value).distance=0,e.done),c=a.value}(n),!0)},W=function(){return'https://lz4.overpass-api.de/api/interpreter?data=[out:json];node["public_transport"="stop_position"]["train"="yes"](around:400.0,'+l.first.lat.toFixed(6)+","+l.first.lng.toFixed(6)+')->.s;rel(bn.s)->.s;node["public_transport"="stop_position"]["train"="yes"](around:400.0,'+l.last.lat.toFixed(6)+","+l.last.lng.toFixed(6)+")->.e;rel(bn.e)->.e;rel.e.s;out tags;"},m=function(e){var n=[];return e[0].elements.forEach(function(e){e.tags.name?n.push(e.tags.name):(n.push("Unnamed route"),console.log("the relation "+e.id+"don't have a name tag."))}),n},b=function(e){d=e[0].elements[e[1].index].id},w=function(){return"https://lz4.overpass-api.de/api/interpreter?data=[out:json];rel("+d.toFixed(0)+');way(r)->.e;way.e["railway"="rail"];(._;>;rel('+d.toFixed(0)+"););out;"},{get icon(){return"iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAAB3RJTUUH4goTCi4V9AmY6AAAAB1pVFh0Q29tbWVudAAAAAAAQ3JlYXRlZCB3aXRoIEdJTVBkLmUHAAAEc0lEQVRIx8VXTUhbWxD+zr0ag77Gqo1/RazRYjcBaxAVoxXFhQtRXLgt2iJUaAl9FBFcPBdtceeuBXGr4uaCq67rz0IaaUtFBcXAq1WjVkhiTm6u3u8tXs1TG6NVyxuYzZy5fHNm5s58R5Ak/gdJOs+htbUVNpsNLpcLZWVlcDqdyMrKujoyE8j4+DhVVaXH42FdXR2tVisBxNTlcnF2dpaXEfyKcyAQIAD29vZydHSUdrudT58+/b3AUkru7OywoaGBdrudpmnyKiLOa67d3V3U19fjy5cvJ+ylpaVwOp3IyMhAWloa7HY7Kioq4HK5kJmZebUaR6NRKooSq6mqqlRVlUKIE7U+ra9fv75aqvPy8giARUVF9Pv91HWduq5TSkmv18v+/n5WVVXFBX/48OHlgFtaWgiA6enpF6pZNBplMBjk3t4e9/b2uL+/T5/P92vA79+/j0Xu9Xov3UBSSn79+jXu2U8DxOfzoa6uDgDw9u1blJeXAwAGBgYwMzODcDgMALBarbh58yZyc3NRXFyMe/fuIT8/H6qqIhKJ4ODgALdu3UJycvL5zfXp06fYTYeGhmL2tra2hM10nj569OjsVGuaRgAUQnBycpIkubi4yOzs7CuBHunu7u7PwD09PQTA27dvMxQKUUrJZ8+eXQvgkTocjpPAhYWFBMCBgQGS5PLy8rUCHtdAIBADVhwOB46GV3V1NQKBwG9bhY2Njf+txa6uLrS3t0PTNFRWVib8sLS0FG63G2VlZSguLsaNGzcQiUTw/ft3bGxs4Nu3b/D7/QgGgwiHw5BSQkoJXdcRjUYRDAah6zpSUlKQpGkapZQCAEKhEFRVxf3791FbW8uGhgbcuXMH+fn5sNvtiWISp3+WODb8SDcsFgvE58+fabPZoKoqsrOzYbFYfivz2NraQk5ODpKcTmfc6C5KiYQQP92YJMWPg9P2w8NDmKYJVdO0v3w+Hw4ODqDrOhRFQWpqKsQFxePxiOnpaUxNTUFRFBQWFuI06NbWFtbX17G9vS0cDoeQUgokJSXFbf2Ojg6+e/eOm5ubjEajZ87j42szIyMjrs/Q0NCJ2W8YBkHSnJubY0lJiXkqCPO4ulwuU9M0U0ppGoZhHsns7KwJgCkpKSwoKCBJmqfoid/vZ15eHm02m7mysmJGIhHzxKw2DIMLCwt0u91nDgFFUWixWHj37l0ODg5yfn6eh4eHCXma1+vl2NgYnzx5QgAMhULx1+LIyAhfvnzJpaUl1tTUXOv06uzsTEwE5ubmaLVa2dTUxImJCb558+ZagI+yk5D66LrO5uZmAmB5eTmXl5c5Pj7OBw8e/DJgZmYm19bWLs4yAWB4eBjd3d0AgL6+Prx69QoAMD8/j48fP2J1dRXb29sIh8MwDANCCITDYZimiZycHHR2dsLtdl+cZR6XnZ0dOhyOWIN9+PDhTN/p6Wl6PB62trYSAGtrazk1NUXDMC73kiDJx4+7KMS/6Xv+3EPD0M/07evrpc32x4mUv3jxJ9fX/+Y/YWHR4vXjhpgAAAAASUVORK5CYII="},getTasks:function(e,n,t,s,a){return l=e,[{task:"loadJsonFile",context:null,func:W},{task:"wait"},{task:"run",context:null,func:m,useResponses:[0]},{task:"showDialog",func:L.travelNotes.interface().selectDialog,context:null,useResponses:[2]},{task:"wait"},{task:"run",context:null,func:b,useResponses:[0,3]},{task:"loadJsonFile",context:null,func:w},{task:"wait"}]},parseResponse:function(e,n,t){return s(e,n)},get name(){return"leaflet.TravelNotesPublicTransport & 0penStreetMap"},get transitModes(){return{car:!1,bike:!1,pedestrian:!1,train:!0}},get providerKeyNeeded(){return!1}}))}()},{}]},{},[1]);